generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?
  Question    Question[]
}

model Option {
  id         String     @id @default(uuid())
  questionId String
  text       String
  value      Int
  Question   Question   @relation(fields: [questionId], references: [id])
  Response   Response[]
}

model Suggestion {
  id           String           @id @default(uuid())
  studentId    String
  teacherId    String
  assignmentId String
  content      String           @db.Text
  createdAt    DateTime         @default(now())
  assignment   TeachersAssigned @relation(fields: [assignmentId], references: [id])
  student      User             @relation("Suggestion_student", fields: [studentId], references: [id])
  teacher      Teacher          @relation(fields: [teacherId], references: [id])
}

model Question {
  id         String       @id @default(uuid())
  question   String
  type       QuestionType @default(LIKERT)
  categoryId String
  Option     Option[]
  Category   Category     @relation(fields: [categoryId], references: [id])
  Response   Response[]
}

model Response {
  id           String           @id @default(uuid())
  studentId    String
  teacherId    String
  questionId   String
  optionId     String?
  answerText   String?
  assignmentId String
  createdAt    DateTime         @default(now())
  assignment   TeachersAssigned @relation(fields: [assignmentId], references: [id])
  Option       Option?          @relation(fields: [optionId], references: [id])
  Question     Question         @relation(fields: [questionId], references: [id])
  student      User             @relation("Response_student", fields: [studentId], references: [id])
  teacher      Teacher          @relation(fields: [teacherId], references: [id])
}

model Student {
  id        String   @id @default(uuid())
  idNumber  Int      @unique
  fullName  String
  programId  String
  program    Program   @relation(fields: [programId], references: [id])
  createdAt DateTime @default(now())
  User      User?
}

model User {
  id                                String     @id @default(uuid())
  idNumber                          Int        @unique
  fullName                          String
  password                          String
  role                              Role       @default(STUDENT)
  studentId                         String?    @unique
  createdAt                         DateTime   @default(now())
  Response_Response_studentIdToUser Response[] @relation("Response_student")
  Suggestion_student                Suggestion[] @relation("Suggestion_student")
  Student                           Student?   @relation(fields: [studentId], references: [id])
}

model Teacher {
  id          String             @id @default(uuid())
  facultyId   Int                @unique
  fullName    String
  createdAt   DateTime           @default(now())
  responses   Response[]
  suggestions Suggestion[]
  assigns     TeachersAssigned[] @relation("TeacherAssignments")
}

model Course {
  id        String             @id @default(uuid())
  code      String             @unique
  name      String
  sectionId String
  section   Section            @relation(fields: [sectionId], references: [id])
  programId String
  Program   Program            @relation(fields: [programId], references: [id])
  assigned  TeachersAssigned[]
}

model Section {
  id        String             @id @default(uuid())
  name      String
  programId String
  Program   Program            @relation(fields: [programId], references: [id])
  courses   Course[]
  assign    TeachersAssigned[]
}

model Program {
  id        String             @id @default(uuid())
  name      String
  assign    TeachersAssigned[]
  students  Student[]
  sections  Section[]
  courses   Course[]           
  createdAt DateTime          @default(now())
}

model TeachersAssigned {
  id          String     @id @default(uuid())
  teacherId   String
  courseId    String
  programId   String
  sectionId   String
  createdAt   DateTime   @default(now())
  responses   Response[]
  suggestions Suggestion[]
  Course      Course     @relation(fields: [courseId], references: [id])
  Program     Program    @relation(fields: [programId], references: [id])
  Section     Section    @relation(fields: [sectionId], references: [id])
  Teacher     Teacher    @relation("TeacherAssignments", fields: [teacherId], references: [id])
}

enum QuestionType {
  LIKERT
  TEXT
}

enum Role {
  STUDENT
  ADMIN
}
